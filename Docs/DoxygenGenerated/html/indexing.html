<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>CotC SDK Unity: The indexing API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="OutputCustomization.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CotC SDK Unity
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The indexing API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CotC provides a generic indexing API which can be used to index and search for any kind of data. You can use it to index gamers (for match making), matches, or anything. It is free-form, so it can apply to every use case.</p>
<p>It works in parallel to other APIs. For instance, you could create a match, then index it to allow searching matches. Or you could index gamer's properties for fast retrieval.</p>
<p>The indexing API is accessible under the <a class="el" href="class_cotc_sdk_1_1_cloud.html#a8b6ebff8093c0e782bba2f7f85adb33f">Cloud.Index</a> object and therefore does not require to be authenticated.</p>
<h2>Indexing matches </h2>
<p>One common case where you will most likely want to use the indexing API is matches. If you allow your players to create matches freely, the number of matches will quickly become huge and you will want to scope them somehow. There are a frew criterias that can be specified when listing the matches (<a class="el" href="class_cotc_sdk_1_1_gamer_matches.html#a17a58535c1568e0b89116a1656b2d16c">Gamer.Matches.List</a>), but they are very generic and will not be enough to properly categorize and do efficient queries among your matches.</p>
<p>Let's take a very simple example: you would like to make some matches private and only list public ones. For that, you will want to associate an additional property with your match that tells whether it is listed publicly. One way to do it is to index your match right after you created it, using the client API as shown below.</p>
<div class="fragment"><div class="line">gamer.Matches.Create(maxPlayers: 16)</div>
<div class="line">.Then(match =&gt;</div>
<div class="line">    cloud.Index(<span class="stringliteral">&quot;matches&quot;</span>).IndexObject(</div>
<div class="line">        objectId: match.MatchId,</div>
<div class="line">        properties: Bundle.CreateObject(<span class="stringliteral">&quot;public&quot;</span>, <span class="keyword">false</span>),</div>
<div class="line">        payload: Bundle.Empty))</div>
<div class="line">.Then(dummy =&gt; {</div>
<div class="line">    Debug.Log(<span class="stringliteral">&quot;Done&quot;</span>);</div>
<div class="line">})</div>
<div class="line">.Catch(ex =&gt; { ... });</div>
</div><!-- fragment --><p>However since you want to ensure that this operation is atomic, you should write it in a more complexe shape that ensures safety and uses persistence to make sure that if the index call fails, you will train again some time later. That is why we recommend you to write a hook that indexes the match as such when being created, and de-index it when not supposed to be available anymore (could also be when the number of players reaches the limit, and so on). The following hooks may be used as is (see <a class="el" href="backoffice.html">The backoffice</a>):</p>
<div class="fragment"><div class="line"><span class="keyword">function</span> after-match-create(params, customData, mod) {</div>
<div class="line">    <span class="stringliteral">&quot;use strict;&quot;</span></div>
<div class="line">    <span class="comment">// don&#39;t edit above this line // must be on line 3</span></div>
<div class="line">    <span class="keywordflow">return</span> this.index.index(this.game.getPrivateDomain(), <span class="stringliteral">&quot;matches&quot;</span>, params.match._id.toString(), params.match.customProperties, {});</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> after-match-finish(params, customData, mod) {</div>
<div class="line">    <span class="stringliteral">&quot;use strict;&quot;</span></div>
<div class="line">    <span class="comment">// don&#39;t edit above this line // must be on line 3</span></div>
<div class="line">    <span class="keywordflow">return</span> this.index.delete(this.game.getPrivateDomain(), <span class="stringliteral">&quot;matches&quot;</span>, params.match._id.toString());</div>
<div class="line">}</div>
</div><!-- fragment --><p>Then using it on the client may be done as follows:</p>
<div class="fragment"><div class="line">gamer.Matches.Create(maxPlayers: 16, customProperties: Bundle.CreateObject(<span class="stringliteral">&quot;public&quot;</span>, <span class="stringliteral">&quot;true&quot;</span>))</div>
<div class="line">.Then(match =&gt; {</div>
<div class="line">    cloud.Index(<span class="stringliteral">&quot;matches&quot;</span>).Search(<span class="stringliteral">&quot;public: true&quot;</span>)</div>
<div class="line">    .Then(result =&gt; {</div>
<div class="line">        Assert(result.Hits.Count == 1);</div>
<div class="line">        <span class="keywordflow">return</span> match.Finish();</div>
<div class="line">    })</div>
<div class="line">    .Then(dummy =&gt; cloud.Index(<span class="stringliteral">&quot;matches&quot;</span>).Search(<span class="stringliteral">&quot;public: true&quot;</span>))</div>
<div class="line">    .Then(result =&gt; {</div>
<div class="line">        Assert(result.Hits.Count == 0);</div>
<div class="line">    })</div>
<div class="line">    .Done();</div>
<div class="line">})</div>
<div class="line">.Done();</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 9 2015 10:17:54 for CotC SDK Unity by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
