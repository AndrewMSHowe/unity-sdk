<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>CotC SDK Unity: Working with achievements</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CotC SDK Unity
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Working with achievements </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CloudBuilder provides a platform independent way of handling achievements for your game. Note that <b>achievements need to be defined on the backoffice</b> before being used on the client.</p>
<p>This page is aimed at being a little tutorial on how to work with achievements from the SDK (client). For the next steps, we will suppose that you already know how to create achievements from the backoffice. For a complete list of useful functions in the SDK, take a look at <a class="el" href="class_cotc_sdk_1_1_gamer_achievements.html">CotcSdk.GamerAchievements</a>.</p>
<h2>Querying the progress of the gamer </h2>
<p>Fetching the state of achievements is a function that require the customer to be logged in. In general, the status of achievements represents an association between a gamer and a game.</p>
<p>The call that we are going to use is <a class="el" href="class_cotc_sdk_1_1_gamer_achievements.html#a003c9c5bbaad6034c9a28ecc26e95a56">CotcSdk.GamerAchievements.List</a>. An example is shown below, we'll create UI buttons with information about each achievement. The GUI toolkit is virtual, and you may want to implement additional features such as pagination.</p>
<div class="fragment"><div class="line">gamer.Achievements.List()</div>
<div class="line">.Done(achievements =&gt; {</div>
<div class="line">    <span class="keywordflow">foreach</span> (var pair <span class="keywordflow">in</span> achievements) {</div>
<div class="line">        <span class="keywordtype">string</span> achName = pair.Key;</div>
<div class="line">        AchievementDefinition ach = pair.Value;</div>
<div class="line"></div>
<div class="line">        Gui.Button button = CreateButton();</div>
<div class="line">        button.ProgressPercent = ach.Progress * 100;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// You can put additional data in the definition (&#39;gameData&#39; node)</span></div>
<div class="line">        <span class="comment">// Here we use that to hide some achievements by default and reveal them</span></div>
<div class="line">        <span class="comment">// explicitely by storing a property in the &#39;gamerData&#39; (for the gamer)</span></div>
<div class="line">        <span class="keywordtype">bool</span> hiddenUnlessUnlocked = ach.GameData[<span class="stringliteral">&quot;initiallyHidden&quot;</span>];</div>
<div class="line">        <span class="keywordtype">bool</span> revealedByGamer = ach.GamerData[<span class="stringliteral">&quot;unhidden&quot;</span>];</div>
<div class="line">        <span class="comment">// Do not show hidden achievements</span></div>
<div class="line">        <span class="keywordflow">if</span> (hiddenUnlessUnlocked &amp;&amp; !revealedByGamer)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Some data can be displayed depending on the achievement name (used as an unique identifier)</span></div>
<div class="line">        <span class="keywordflow">if</span> (pair.Key == <span class="stringliteral">&quot;supersonic&quot;</span>) {</div>
<div class="line">            <span class="comment">// Display your text, potentially localized based on the state of the gamer</span></div>
<div class="line">            button.Title = <span class="stringliteral">&quot;Supersonic runner!&quot;</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (ach.Progress &gt;= 1)</div>
<div class="line">                button.Subtitle = <span class="stringliteral">&quot;Achievement obtained because you rock!&quot;</span>;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                button.Subtitle = <span class="stringliteral">&quot;Finish the game in under one hour!&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">});</div>
</div><!-- fragment --><h2>Notifying progress </h2>
<p>If you have configured your achievements through the backoffice, you know that achievements are triggered when so-called units reach a certain value. This means that to trigger an achievement, you will increase the value of an unit by using a transaction. Let's consider the following transaction on the server:</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;supersonic&quot;</span> {</div>
<div class="line">    <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;limit&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;config&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;unit&quot;</span>: <span class="stringliteral">&quot;supersonic&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;maxValue&quot;</span>: 1</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you want to trigger that achievement, you will simply do a transaction for this unit:</p>
<div class="fragment"><div class="line">gamer.Transactions.Post(Bundle.CreateObject(<span class="stringliteral">&quot;supersonic&quot;</span>, +1))</div>
<div class="line">.Done(txResult =&gt; {</div>
<div class="line">    Debug.Log(txResult.TriggeredAchievements.Count); <span class="comment">// 1</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2>Domains </h2>
<p>By default, achievements use the key/value storage associated with the private domain (that is, reserved for this game). You may create achievement on different domains, in which case they refer to units posted in the corresponding domain.</p>
<h2>Associating user data with an achievement </h2>
<p>Arbitrary data can be associated for an user and an achievement by using the <a class="el" href="class_cotc_sdk_1_1_gamer_achievements.html#a6ef27a10428476e9a5f9d2e9ed5d0a4b">CotcSdk.GamerAchievements.AssociateData</a> API call. For instance, this could be used to store any useful detail on how the gamer was realized. The following example describes yet another use case: we want to unhide an achievement that has been marked as hidden by default and not listed in the section above.</p>
<div class="fragment"><div class="line">gamer.Transactions.Post(Bundle.CreateObject(<span class="stringliteral">&quot;supersonic&quot;</span>, +1))</div>
<div class="line">.Then(txResult =&gt; {</div>
<div class="line">    <span class="comment">// Achievement triggered =&gt; associate data</span></div>
<div class="line">    <span class="keywordflow">if</span> (txResult.TriggeredAchievements.ContainsKey(<span class="stringliteral">&quot;supersonic&quot;</span>)) {</div>
<div class="line">        <span class="keywordflow">return</span> gamer.Achievements.AssociateData(<span class="stringliteral">&quot;supersonic&quot;</span>, Bundle.CreateObject(<span class="stringliteral">&quot;unhidden&quot;</span>, <span class="keyword">true</span>));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> null; <span class="comment">// Nothing to do next</span></div>
<div class="line">})</div>
<div class="line">.Done(result =&gt; { <span class="comment">/* All done properly */</span> });</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 30 2015 23:16:50 for CotC SDK Unity by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
