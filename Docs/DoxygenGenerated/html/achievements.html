<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>CloudBuilder Unity: Working with achievements</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CloudBuilder Unity
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Working with achievements </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CloudBuilder provides a platform independent way of handling achievements for your game. Note that <b>achievements need to be defined on the backoffice</b> before being used on the client.</p>
<p>This page is aimed at being a little tutorial on how to work with achievements from the CloudBuilder SDK (client). For the next steps, we will suppose that you already know how to create achievements from the backoffice. For a complete list of useful functions in the SDK, take a look at Achievements module.</p>
<h2>Querying the progress of the gamer </h2>
<p>Fetching the state of achievements is a function that require the customer to be logged in. In general, the status of achievements represents an association between a gamer and a game.</p>
<p>The call that we are going to use is <code>ListAchievements</code>:</p>
<p><code>void CloudBuilder::CUserManager::ListAchievements(const CotCHelpers::CHJSON *configuration, CloudBuilder::CResultHandler *handler)</code></p>
<p>This call requires a configuration passed in the form of a <code>CHJSON</code> object as usual. Read the documentation for more information on the keys that should be passed. An example is shown below, we'll create UI buttons with information about each achievement. The GUI toolkit is virtual, and you may want to implement additional features such as pagination.</p>
<div class="fragment"><div class="line">CHJSON config;</div>
<div class="line">CUserManager::Instance()-&gt;ListAchievements(&amp;config, MakeResultHandler(<span class="keyword">this</span>, &amp;MyGame::OnListedAchievements));</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (code == enNoErr) {</div>
<div class="line">    <span class="keyword">const</span> CHJSON *achievements = result-&gt;GetJSON()-&gt;GetSafe(<span class="stringliteral">&quot;achievements&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (CHJSON::Iterator it = achievements-&gt;begin(); it != achievements-&gt;end(); ++it) {</div>
<div class="line">        <span class="keyword">const</span> CHJSON *node = *it;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *achievementName = node-&gt;name();</div>
<div class="line">        <span class="keywordtype">double</span> progress = node-&gt;GetDouble(<span class="stringliteral">&quot;progress&quot;</span>);</div>
<div class="line"></div>
<div class="line">        GUI::Button *button = buttonList-&gt;AddButton();</div>
<div class="line">        <span class="comment">// The progress is expressed as a floating point number between 0 and 1</span></div>
<div class="line">        button-&gt;progressPercent = progress * 100.0;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// You can put additional data in the definition (&#39;gameData&#39; node)</span></div>
<div class="line">        <span class="comment">// Here we use that to hide some achievements by default and reveal them</span></div>
<div class="line">        <span class="comment">// explicitely by storing a property in the &#39;gamerData&#39; (for the gamer)</span></div>
<div class="line">        <span class="keywordtype">bool</span> hiddenUnlessUnlocked = node-&gt;GetSafe(<span class="stringliteral">&quot;gameData&quot;</span>)-&gt;GetBool(<span class="stringliteral">&quot;initiallyHidden&quot;</span>);</div>
<div class="line">        <span class="keywordtype">bool</span> revealedByGamer = node-&gt;GetSafe(<span class="stringliteral">&quot;gamerData&quot;</span>)-&gt;GetBool(<span class="stringliteral">&quot;unhidden&quot;</span>);</div>
<div class="line">        <span class="comment">// Do not show hidden achievements</span></div>
<div class="line">        <span class="keywordflow">if</span> (hiddenUnlessUnlocked &amp;&amp; !revealedByGamer)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Some data can be displayed depending on the achievement name (used as an unique identifier)</span></div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(achievementName, <span class="stringliteral">&quot;supersonic&quot;</span>)) {</div>
<div class="line">            <span class="comment">// Display your text, potentially localized based on the state of the gamer</span></div>
<div class="line">            button-&gt;title = <span class="stringliteral">&quot;Supersonic runner!&quot;</span>;</div>
<div class="line">            <span class="keywordflow">if</span> (progress &gt;= 1)</div>
<div class="line">                button-&gt;subtitle = <span class="stringliteral">&quot;Achievement obtained because you rock!&quot;</span>;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                button-&gt;subtitle = <span class="stringliteral">&quot;Finish the game in under one hour!&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Notifying progress </h2>
<p>If you have configured your achievements through the backoffice, you know that achievements are triggered when so-called units reach a certain value. This means that to trigger an achievement, you will increase the value of an unit. An easy way to perform that is by using the following method.</p>
<p><code>void CloudBuilder::CUserManager::EarnAchievment(const char *unit, int increment, const CHJSON *gamerData, CResultHandler *handler);</code></p>
<p>Most parameters except for the <code>unit</code> can be left at their default value, which means that the unit will be incremented from one and no gamer data will be posted. The following example shows how to notify an achievement. We expect an achievement like that to have been configured in the backoffice :</p>
<div class="fragment"><div class="line"><span class="stringliteral">&quot;supersonic&quot;</span> {</div>
<div class="line">    <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;limit&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;config&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;unit&quot;</span>: <span class="stringliteral">&quot;supersonic&quot;</span>,</div>
<div class="line">        <span class="stringliteral">&quot;maxValue&quot;</span>: 1</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The special thing here is that the name of the achievement is the same as the unit, which should be perfect for most achievements. Posting an achievement is done as follows:</p>
<div class="fragment"><div class="line">CUserManager::Instance()-&gt;EarnAchievement(<span class="stringliteral">&quot;supersonic&quot;</span>, +1, NULL, MakeResultHandler(<span class="keyword">this</span>, MyGame::OnEarnAchievement));</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MyGame::OnEarnAchievement(eErrorCode code, <span class="keyword">const</span> CCloudResult *result) {</div>
<div class="line">    <span class="keywordflow">if</span> (code == enNoErr) {</div>
<div class="line">        <span class="comment">// Process the response</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now on processing the response. The result is what you get from CloudBuilder::CUserManager::TransactionV2. That is, two nodes: <code>balance</code> and <code>achievements</code>. For a player who has never played before, the result should look like:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;balance&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;supersonic&quot;</span>:   1</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;achievements&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;supersonic&quot;</span>: {</div>
<div class="line">            <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;limit&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;config&quot;</span>: {</div>
<div class="line">                <span class="stringliteral">&quot;maxValue&quot;</span>: 1,</div>
<div class="line">                <span class="stringliteral">&quot;unit&quot;</span>: <span class="stringliteral">&quot;supersonic&quot;</span></div>
<div class="line">            },</div>
<div class="line">            <span class="stringliteral">&quot;progress&quot;</span>: 1,</div>
<div class="line">            <span class="stringliteral">&quot;gamerData&quot;</span>: {</div>
<div class="line">                <span class="stringliteral">&quot;key&quot;</span>: <span class="stringliteral">&quot;value&quot;</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is it for the "simple" version. Achievements provide much more powerful functionality, which you can access by separately calling CloudBuilder::CUserManager::TransactionV2 (to post the fact that an unit has changed, potentially realizing an achievement) and CloudBuilder::CUserManager::SetAchievementData to associate data with the achievement if needed.</p>
<p>The previous call would look like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>CloudBuilder;</div>
<div class="line">CHJSON config, tx;</div>
<div class="line">tx.Put(<span class="stringliteral">&quot;supersonic&quot;</span>, +1);</div>
<div class="line">config.Put(<span class="stringliteral">&quot;transaction&quot;</span>, tx);</div>
<div class="line">config.Put(<span class="stringliteral">&quot;description&quot;</span>, <span class="stringliteral">&quot;Earned achievement supersonic by 1&quot;</span>);</div>
<div class="line"><span class="comment">// The OnEarnAchievement can be the same as before</span></div>
<div class="line">CUserManager::Instance()-&gt;TransactionV2(&amp;config, MakeResultHandler(<span class="keyword">this</span>, MyGame::OnEarnAchievement));</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> MyGame::OnEarnAchievement(eErrorCode code, <span class="keyword">const</span> CCloudResult *result) {</div>
<div class="line">    <span class="keywordflow">if</span> (code == enNoErr) {</div>
<div class="line">        <span class="comment">// And store associated data with the achievement</span></div>
<div class="line">        CHJSON config;</div>
<div class="line">        config.Put(<span class="stringliteral">&quot;domain&quot;</span>, <span class="stringliteral">&quot;private&quot;</span>);        <span class="comment">// default value, so not necessary</span></div>
<div class="line">        config.Put(<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;supersonic&quot;</span>);</div>
<div class="line">        config.Put(<span class="stringliteral">&quot;data&quot;</span>, 12345);              <span class="comment">// anything actually</span></div>
<div class="line">        CUserManager::Instance()-&gt;SetAchievementData(&amp;config, ...);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that this time, we are making a transaction with a key value of name <code>supersonic</code>, and we are storing data (<code>SetAchievementData</code>) with the achievement <code>supersonic</code>. Unlike the previous call to <code>EarnAchievement</code>, they need not be the same. You could for instance configure an achievement named <code>beRich</code> which triggers when <code>goldCoins</code> reaches 100000. In that case, you would pass different strings to <code>TransactionV2</code> (<code>goldCoins</code>) and <code>SetAchievementData</code> (<code>beRich</code>).</p>
<h2>Domains </h2>
<p>By default, achievements use the key/value storage associated with the private domain (that is, reserved for this game). You may create achievement on different domains, in which case they refer to units posted in the corresponding domain.</p>
<h2>Associating user data with an achievement </h2>
<p>Data can be associated for an user and an achievement. To store it, pass a <code>CHJSON</code> as third parameter to CloudBuilder::CUserManager::EarnAchievement. Or call CloudBuilder::CUserManager::SetAchievementData as shown below. In the following case, we want to unhide an achievement that has been marked as hidden by default and not listed in the section above.</p>
<div class="fragment"><div class="line">CHJSON config, data;</div>
<div class="line">data.Put(<span class="stringliteral">&quot;unhidden&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">config.Put(<span class="stringliteral">&quot;data&quot;</span>, data);</div>
<div class="line">config.Put(<span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;supersonic&quot;</span>);</div>
<div class="line">CUserManager::Instance()-&gt;SetAchievementData(&amp;config, MakeResultHandler(...));</div>
</div><!-- fragment --><p>Other uses for data stored by user and achievement include storing any useful detail on how the gamer did get the score. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 3 2015 10:46:18 for CloudBuilder Unity by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
